<!DOCTYPE html>
<html>
<title>水处理系统监控系统</title>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Arise Admin Dashboard" />
	<meta name="keywords" content="Admin, Dashboard, Bootstrap3, Sass, transform, CSS3, HTML5, Web design, UI Design, Responsive Dashboard, Responsive Admin, Admin Theme, Best Admin UI, Bootstrap Theme, Themeforest, Bootstrap, C3 Graphs, D3 Graphs, NVD3 Graphs, Admin Skin, Black Admin Dashboard, Grey Admin Dashboard, Dark Admin Dashboard, Simple Admin Dashboard, Simple Admin Theme, Simple Bootstrap Dashboard, Invoice, Tasks, Profile" />
	<meta name="author" content="Ramji" />
	<link rel="shortcut icon" href="img/fav.png">
	<title>聆风智控</title>

	<!-- Bootstrap CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet" media="screen" />

	<!-- Main CSS -->
	<link href="css/main.css" rel="stylesheet" media="screen" />
	<!-- <index.css> -->
	<link href="css/index.css" rel="stylesheet" media="screen" />

	<!-- Ion Icons -->
	<link href="fonts/icomoon/icomoon.css" rel="stylesheet" />
	<link href="font/iconfont.css" rel="stylesheet" />


	<!-- 翻页计数器动画css -->
	<link rel="stylesheet" href="css/index-style.css" />


	<!-- 消息弹窗 -->
	<link rel="stylesheet" href="css/bootstrap.min.css">

	<!--事件列表-->
	<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/message.css">

	<link href="css/light-theme.min.css" rel="stylesheet">
	<link href="css/dark-theme.min.css" rel="stylesheet">
	<link href="css/colored-theme.min.css" rel="stylesheet">

</head>
<body style="overflow-y: hidden;overflow-x: auto;">
<!-- Loading starts -->
<div class="loading-wrapper">
	<div class="loading">
		<h5>Loading...</h5>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
	</div>
</div>
<!-- Loading ends -->

<!-- Header starts -->
<header>
	<div class="custom-search hidden-sm hidden-xs">
		<!---->
		<span class="Land"><i class="iconfont icon-denglu"></i>欢迎您，&nbsp;<b></b>&nbsp;<a href="#" id="reset">管理</a>&nbsp;<a href="#" id="exit">注销</a></span>
	</div>
</header>
<!-- Header ends -->

<!-- 左侧边栏 start -->
<div class="vertical-nav vertical-nav-sm">

	<!--导航菜单 starts -->
	<button class="collapse-menu">
		<i class="icon-menu2"></i>
	</button>
	<!-- 导航菜单 ends -->
	<!-- 边栏菜单start -->
	<ul class="menu clearfix">
		<li class="active selected">
			<a a class="J_menuItem" href="#"  id="p4">
				<i class="icon-air-play"></i>
				<span class="menu-item">主页</span>
			</a>
		</li>
		
		<li>
			<a href='widgets.html'>
				<i class="iconfont icon-shujufenxi1"></i>
				<span class="menu-item">数据分析</span>
				<span class="down-arrow"></span>
			</a>
			<ul>
				<li>
					<a a class="J_menuItem" href="#"  id="p0">历史曲线数据</a>
				</li>
				<li>
					<a a class="J_menuItem" href="#"  id="p1">历史数据一览表</a>
				</li>
			</ul>
		</li>
		<li id="author" style="display: none">
			<a a class="J_menuItem" href="#"  >
				<i class="iconfont icon-sheding"></i>
				<span class="menu-item">系统管理</span>
			</a>
			<ul>
				<li>
					<a a class="J_menuItem" href="#"  id="p2">限值设定</a>
				</li>
				<li>
					<a a class="J_menuItem" href="#"  id="p6">事件管理</a>
				</li>
				<li>
					<a a class="J_menuItem" href="#"  id="p5">用户管理</a>
				</li>
			</ul>
		</li>
		<li>
			<a a class="J_menuItem" href="#"  id="p3">
				<i class="iconfont icon-wenjianguanli1"></i>
				<span class="menu-item">事件记录</span>
			</a>
		</li>
	</ul>
	<!-- 边栏菜单 end -->
</div>
<!-- 左侧边栏 end -->
<!-- Dashboard Wrapper Start -->
<div class="dashboard-wrapper">

	<!-- Container fluid Starts -->
	<div class="container-fluid">


		<!-- 嵌入页面 starts -->
		<div class="row J_mainContent" id="content-main">

			<iframe  src="#" id="iframe_a" style=" width:100%;height:92%;padding-left: 0px;margin-left: 0px;" frameborder="0" ></iframe>
		</div>
		<!-- 嵌入页面 end -->
		<footer>

			<!--<button id="show-notification-default-warning" class="btn btn-outline-warning">Show me a notification (Warning)</button>-->
			建议分辨率1920*1080
			<div id="message" ></div>
		</footer>
	</div>
	<!-- Container fluid ends -->

</div>
<!-- Dashboard Wrapper End -->
<!-- Footer Start -->

<!-- Footer end -->

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery.js"></script>
<!-- 导航跳转外部 Js -->
<script src="js/jquery.gesture.password.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
<!-- jquery ScrollUp JS -->
<!-- <script src="js/scrollup/jquery.scrollUp.js"></script> -->
<!-- Custom JS 原来自带-->
<script src="js/custom.js"></script>
<!-- echart Js -->
<!-- <script type="text/javascript" src="js/echarts.min.js"></script> -->
<!-- 自己index Js -->
<!-- <script type="text/javascript" src="js/index.js"></script>-->
<!-- 翻页计数器动画 Js -->
<!-- <script type="text/javascript" src="js/jquery.dataStatistics.js"></script>-->
<!-- 导航跳转内部 Js -->
<script type="text/javascript"  src="setup.js"></script>

<!-- 消息弹窗 Js -->
<script type="text/javascript" src="js/growl-notification.min.js"></script>

<!-- 事件列表 Js -->
<script src="js/message.js"></script>
<script type="text/javascript">

	opttype=['info','warning','error','danger','success','Sorry!'];
	var sn = 0;
	var gk ;
	var ckball = true;
	var opt ={
		elem: "#message",
		msgData: [],
		msgUnReadData: 0,

		msgClick: function(obj) {
			//alert(obj.id);
			setEvtStat(obj.id);

			//alert("消息点击事件");
		},
		noticeClick: function(obj) {
			//alert("提醒点击事件");
		},
		allRead: function(obj) {
			//alert("全部已读");
		},
		getNodeHtml: function(obj, node) {
			if (obj.readStatus == 1) {
				node.isRead = true;
			} else {
				node.isRead = false;
			}
			var html = "<p>"+ obj.text +"</p>";

			node.html = html;

			return node;
		}
	}
	/* $(function(){
         opt.msgData=[{text: "message1", id: 1, readStatus: 1},
             {text: "message2", id: 2, readStatus: 0},
             {text: "message3", id: 3, readStatus: 0},
             {text: "message4", id: 4, readStatus: 0},
             {text: "message5", id: 5, readStatus: 0},
             {text: "message6", id: 6, readStatus: 0}];
         MessagePlugin.init(opt);
     });*/
	function chgckball()
	{
		loadEvt(gk,sn);
	}
	function setEvtStat(inf) {
		console.log(gkey);
		$.ajax({
			url: httpIp + '/LF/setEvtStat',
			type: 'POST',
			async: true,
			timeout: timeOutNum,
			data: { info:inf },
			dataType: 'json',
			//beforeSend: beforeSend, //发送请求
			//complete: complete, //请求完成
			success: function(data, textStatus, jqXHR) {
				console.log(data);
				if (data.result == 1) {

					loadEvt(gk,sn);
				}
				else
				{

				}
			},
			error: function(xhr, textStatus) {
				//editHot.loadData([]);
			}
		})
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");

	}
	function loadEvt(gk,a) {

		var cka =1;
		if($('#ckball').prop('checked'))
		{
			cka = 0;
		}
		//console.log(cka);
		//console.log(a);
		$.ajax({
			url: httpIp + '/LF/loadEvt',
			type: 'POST',
			async: true,
			timeout: timeOutNum,
			data: { gky:gk ,xh:a,ck:cka},
			dataType: 'json',
			//beforeSend: beforeSend, //发送请求
			//complete: complete, //请求完成
			success: function(data, textStatus, jqXHR) {
				console.log(data);
				if (data.result == 1) {

					opt.msgData=data.data;
					MessagePlugin.init(opt);
					MessagePlugin.update();

				}
				else
				{

				}
			},
			error: function(xhr, textStatus) {
				//editHot.loadData([]);
			}
		})
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");

	}
	function askforward()
	{
		sn-=1;
		if (sn<0)
		{
			sn = 0;
			$('#pageinfo').text('已是最新');
		}
		else
		{
			loadEvt(gk,sn);
		}
	}
	function askback()
	{
		sn+=1;
		if (sn>0)
		{

			$('#pageinfo').text('');
		}
		loadEvt(gk,sn);
	}

	function getOptions() {
		var position = 'top-right';
		var closeTimeout = 0;   //0,1000,3000,5000
		var animation = 'slide';
		var showButtons = false;
		var showProgressBar = false;
		var animationOptions = {
			open: animation + '-in',
			close: animation + '-out'
		};

		if (animation === 'none') {
			animationOptions = {
				open: false,
				close: false
			};
		}

		return options = {
			description: 'I am a default notification',
			position: position,
			closeTimeout: closeTimeout,
			closeWith: ['click'],
			animation: animationOptions,
			showButtons: showButtons,
			buttons: {
				action: {
					callback: function (notification) {
						console.log('action button');
					}
				}
			},
			showProgress: showProgressBar
		};
	}
	$('#show-notification-default-warning').on('click', function () {
		var options = getOptions();
		options.title = 'Reminder!';
		options.description = 'You have a meeting at 10:30 АМ';
		options.type = 'warning';      //'success','error','info','danger','Sorry!'
		GrowlNotification.notify(options);
	});
	$("a[id^='p']").click(function () {
		var t = this.id;
		$("#passwd").hide();
		t=t.substring(t.indexOf("p")+1);
		nowTab = t;
		
		$("#iframe_a").attr("src",url1[t]) ;
		$("#iframe_a").show();

	});

	var  ws;
	//var url="ws://192.168.3.191:8080/qs/chatSocket?username=dd";
	//var usr = '${sessionScope.username }';
	//var gkey = '${sessionScope.groupKey }';
	var url="";
	//console.log(url);
	//var url="ws://192.168.3.203:8080/qs/chatSocket?username="+usr;
	//window.onload=connect;
	function connect(){
		//console.log(url);
		$.ajax({
			url:httpIp + '/LF/getsessions',
			dataType : "json",
			type : "POST",
			success : function(data) {
				if(data) {
					console.log(data);
					if (data.result==1)
					{
						var pag = $('#author');
						if(data.leval==1){
							pag.show();
						}
						else{
							pag.hide();
						}
						console.log(data.domain);
						setCookie('domain',data.domain);
						setCookie('gkey',data.gkey);
						setCookie('leval',data.leval);
						setCookie('uid',data.auth);
						setCookie('uname',data.uname);
						gk = data.gkey;
						document.getElementsByTagName('b')[0].innerHTML=data.uname;
						loadEvt(data.gkey,0);
						$('#exit').attr('href',httpIp + '/LF/LogoutServlet');
						$(document).on("click", "#reset", function() { $('#iframe_a').attr('src','reset.html'); });
						$('#iframe_a').attr('src','svr_'+data.gkey+'/Page'+data.leval+'.htm');
						url1[4]= "http://"+ip_addr+":"+port+"/LF/svr_" + data.gkey + '/Page' + data.leval + '.htm';
						url="ws://"+ip_addr+":"+port+"/LF/chatSocket?username="+data.uname+"&gkey="+data.gkey+"&uid="+data.auth;

						if ('WebSocket' in window) {
							ws = new WebSocket(url);
						} else if ('MozWebSocket' in window) {
							ws = new MozWebSocket(url);
						} else {
							alert('WebSocket is not supported by this browser.');
							return;
						}
						ws.onerror = function () {
							setMessageInnerHTML("WebSocket连接发生错误");
						};
						//连接成功建立的回调方法
						ws.onopen = function () {
							console.log("WebSocket连接成功");
						}
						//接收到消息的回调方法
						/*ws.onmessage = function (event) {
							//将接收到的二进制数据转为字符串
							var unit8Arr = new Uint8Array(event.data) ;
							setMessageInnerHTML(byteToString(unit8Arr));
						}*/
						//连接关闭的回调方法
						ws.onclose = function () {
							setMessageInnerHTML("WebSocket连接关闭");
						}
						//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
						window.onbeforeunload = function () {

							$.post("LogoutServlet", function (result) {
								console.log(result);
							});
							closeWebSocket();
						}

						function setMessageInnerHTML(innerHTML) {
							// alert( innerHTML);
						}
						//关闭WebSocket连接
						function closeWebSocket() {
							ws.close();
						}





						ws.onmessage=function(event){
							// console.log(event.data);
							var results=JSON.parse(event.data);





							//var yxrd=results.edd;
							//console.log(ycrd);
							//localStorage.clear();
							if (results)
							{
								if(results.hasOwnProperty('msg'))
								{
									var msg = (results['msg']);
									console.log(msg);
									var options = getOptions();
									options.title = msg.title;
									options.description =msg.message;//'You have a meeting at 10:30 АМ';
									options.type = opttype[msg.type];//'warning';      //'success','error','info','danger','Sorry!'
									//options.title = 'Reminder!';
									//options.description = 'You have a meeting at 10:30 АМ';
									//options.type = 'warning';      //'success','error','info','danger','Sorry!'

									GrowlNotification.notify(options);
								}else
								{
									for (var key in results)
									{
										if(key!='msg')
											localStorage.setItem(key, results[key]);

									}
								}



							}else
							{
								//ycrd[0]=results.dev;
								// ycrd[1]=results.data;
								console.log("no data received!");
								//localStorage.setItem(results.dev, results.data);

							}


							//console.log(localStorage);
							/*
                            if(result.alert!=undefined){
                                $("#content").append(result.alert+"<br/>");
                            }

                            if(result.names!=undefined){
                                $("#userList").html("");
                                $(result.names).each(function(){
                                    $("#userList").append(this+"<br/>");
                                });
                            }

                            if(result.from!=undefined){
                                $("#content").append(result.from+" "+result.date+
                                        " 说：<br/>"+result.sendMsg+"<br/>");
                            }*/
							//for (i=0;i<100;i++)
							//$("#content").append(localStorage.getItem("data"+i)+"<br/>");

						};
					}
					else
					{
						var returned = confirm("没登录吗？");
						if(returned){

                          window.location.href = "http://"+ip_addr+":"+port+"/LF/login.html";
						}else{
                          window.location.href = "http://"+ip_addr+":"+port+"/LF/login.html";
						}
					}

				}else{
					alert("something wrong!");
				}
			}
		});




		//

	}

	function  send(){
		var value= $("#msg").val();
		ws.send(value);
	}





	function reSetSize() {
		var windowsHeight = window.innerHeight;
		document.getElementById("content-main").style.height = (windowsHeight-60) + "px";
	}

	$(document).ready(function(){
		$("#ckball").prop("checked",true);
		window.onresize = reSetSize;

		// 嵌入页面高度自适应 Js starts
		reSetSize();
		connect();
	});

</script>

</body>
</html>
</body>


</html> 